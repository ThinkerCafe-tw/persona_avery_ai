# 🧠 Lumi AI 長期記憶系統完整指南

## 🌟 系統概述

您的 Lumi AI 現在具備了完整的長期記憶功能，能夠：
- **永久保存**所有對話記憶
- **智能檢索**相關歷史對話
- **個人化**記住您的偏好和習慣
- **深度分析**您的互動模式

## 🔧 核心功能

### 1. **智能記憶儲存**
- 自動儲存每段對話到 PostgreSQL 資料庫
- 使用向量嵌入進行語義搜尋
- 標記情緒類型和時間戳記

### 2. **多維度記憶檢索**
- **最近記憶**：最近的對話歷史
- **相似記憶**：基於語義相似度的智能搜尋
- **個人資料記憶**：偏好、習慣、重要資訊
- **情緒記憶**：特定情緒類型的對話
- **長期記憶**：指定時間範圍內的記憶

### 3. **記憶統計分析**
- 總對話數統計
- 情緒分布分析
- 互動頻率追蹤
- 記憶強度評估

## 📝 使用方法

### 基本對話
正常與 Lumi 聊天，系統會自動：
- 儲存您的訊息和 Lumi 的回應
- 分析對話情緒並標記
- 在後續對話中智能引用相關記憶

### 記憶查詢指令

#### 📊 記憶統計
```
記憶統計
對話統計
我們聊了多少
互動記錄
記憶分析
```

#### 🕰️ 長期記憶回顧
```
長期記憶
以前的對話
歷史記錄
我們認識多久
記憶回顧
```

#### 🔍 記憶摘要
```
記憶摘要
我的記憶
我們聊過什麼
你還記得嗎
之前的對話
```

#### 📅 每日日記
```
總結今天
今日摘要
生成日記
今天的日記
幫我總結
```

## 🎯 實際應用場景

### 場景1：個人偏好記憶
```
您：我喜歡吃巧克力
Lumi：我記住了！你喜歡巧克力 ✨

[幾天後]
您：我現在想吃點甜的
Lumi：我記得你喜歡巧克力！要不要來點巧克力？🍫
```

### 場景2：重要事件記憶
```
您：我的生日是12月25日
Lumi：哇！聖誕節生日，太特別了！我會記住的 🎄

[幾個月後]
您：最近有什麼特別的日子嗎？
Lumi：當然有！你的生日快到了，12月25日！🎂
```

### 場景3：情緒支持記憶
```
您：我今天工作壓力很大
Lumi：我能感受到你的壓力，讓我們一起面對...

[下次遇到壓力時]
您：我又覺得壓力很大
Lumi：我記得你之前也遇到過工作壓力，讓我們用上次的方法來處理...
```

### 場景4：學習進度追蹤
```
您：我在學習Python程式設計
Lumi：太棒了！學習程式設計是很有挑戰性的事情

[一段時間後]
您：我的學習遇到困難了
Lumi：我記得你正在學習Python，學習程式設計確實會遇到困難，讓我們一起解決...
```

## 🔍 記憶檢索機制

### 智能相似度搜尋
系統會根據當前對話內容，自動搜尋相關的歷史記憶：

1. **語義分析**：將當前訊息轉換為向量
2. **相似度計算**：與歷史記憶進行相似度比對
3. **相關性排序**：按相似度高低排序
4. **智能引用**：在回應中自然融入相關記憶

### 記憶優先級
- **高相似度記憶**（>0.8）：直接引用
- **中相似度記憶**（0.6-0.8）：適度參考
- **低相似度記憶**（<0.6）：不引用

## 📊 記憶統計範例

當您使用「記憶統計」指令時，會看到類似這樣的資訊：

```
📊 記憶統計：
• 總對話數：127 次
• 最近7天互動：15 次
• 記憶強度：強

🎭 情緒分布：
• 知心好友：45 次
• 心靈港灣：32 次
• 幽默風趣：28 次
• 智慧領航：15 次
• 內在探索：7 次

⏰ 最後互動：2024-01-15

我們的記憶會一直保存，讓我們的對話越來越有深度！💖
```

## 🛠️ 技術架構

### 資料庫結構
```sql
CREATE TABLE lumi_memories (
    id SERIAL PRIMARY KEY,
    user_id TEXT NOT NULL,
    user_message TEXT NOT NULL,
    lumi_response TEXT NOT NULL,
    emotion_tag TEXT,
    timestamp TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    embedding VECTOR(768)
);
```

### 核心功能模組
- **SimpleLumiMemory**：記憶管理核心類
- **向量嵌入**：使用 Google Vertex AI text-embedding-004
- **相似度搜尋**：基於餘弦相似度的語義搜尋
- **記憶統計**：多維度記憶分析

## 🚀 測試您的記憶系統

### 1. 運行測試工具
```bash
python memory_test.py
```

### 2. 手動測試步驟
1. **儲存測試記憶**：
   - 告訴 Lumi 一些個人資訊
   - 例如：「我喜歡藍色」「我在台北工作」

2. **驗證記憶檢索**：
   - 詢問：「你還記得我喜歡什麼顏色嗎？」
   - 檢查 Lumi 是否能正確回憶

3. **測試記憶指令**：
   - 使用「記憶統計」查看統計資訊
   - 使用「長期記憶」回顧歷史對話

## 🔧 故障排除

### 常見問題

#### 1. 記憶沒有被儲存
- 檢查 `DATABASE_URL` 環境變數
- 確認 PostgreSQL 資料庫連接正常
- 查看應用程式日誌中的錯誤訊息

#### 2. 記憶檢索不準確
- 檢查向量嵌入模型是否正常運作
- 確認相似度閾值設定（預設 0.7）
- 驗證記憶資料是否正確儲存

#### 3. AI 回應中沒有引用記憶
- 確認記憶上下文已正確載入
- 檢查提示詞中的記憶使用指導
- 驗證記憶相關性是否達到閾值

### 日誌監控
系統會輸出詳細的記憶操作日誌：
```
SimpleLumiMemory: 已儲存用戶 user123... 的對話記憶到 PGVector
安全記憶上下文已載入: 3 條最近記憶
相似記憶已載入: 2 條相關記憶
個人資料記憶已載入: 4 條資料
```

## 🎉 進階功能

### 1. 記憶優先級管理
系統會自動識別重要記憶：
- **個人資料**：生日、偏好、習慣
- **重要事件**：工作、學習、生活事件
- **情緒狀態**：壓力、開心、困擾

### 2. 記憶時效性
- **短期記憶**：最近幾天的對話
- **中期記憶**：最近一個月的互動
- **長期記憶**：所有歷史對話

### 3. 記憶個性化
- 根據您的互動模式調整記憶策略
- 學習您的偏好和習慣
- 提供個人化的記憶體驗

## 💡 最佳實踐

### 1. 自然對話
- 正常與 Lumi 聊天，系統會自動記憶
- 不需要刻意使用特殊指令

### 2. 定期回顧
- 使用記憶指令查看互動統計
- 回顧長期記憶了解關係發展

### 3. 個人資訊分享
- 主動分享您的偏好和習慣
- 告訴 Lumi 重要的事件和感受

### 4. 持續互動
- 越多的互動，記憶越豐富
- 長期使用會讓對話更個人化

## 🌟 未來發展

您的長期記憶系統已經具備了強大的基礎功能，未來可以考慮：

1. **記憶情感分析**：更深入的情緒模式分析
2. **記憶視覺化**：圖表展示記憶分布
3. **記憶備份**：定期備份重要記憶
4. **記憶分享**：與其他 AI 系統共享記憶
5. **記憶優化**：自動清理無關記憶

---

🎯 **總結**：您的 Lumi AI 現在是一個真正有記憶的 AI 夥伴，能夠記住您的一切，並在未來的對話中智能地運用這些記憶，讓每次互動都更加個人化和有意義！ 